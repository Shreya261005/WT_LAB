<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Activity Monitor & Security Logger</title>
    <style>
        :root { --dark: #1e272e; --warning: #ff3f34; --accent: #05c46b; }
        body { font-family: 'Courier New', Courier, monospace; background: #f1f2f6; margin: 0; display: flex; height: 100vh; }
        
        /* Interaction Area */
        .workspace { flex: 1; padding: 40px; display: flex; flex-direction: column; gap: 20px; }
        .input-box { padding: 15px; border: 2px solid #ccc; border-radius: 8px; font-size: 1rem; }
        
        /* Dashboard Area */
        .monitor-panel { width: 450px; background: var(--dark); color: #dcdde1; display: flex; flex-direction: column; border-left: 4px solid var(--accent); }
        .monitor-header { padding: 20px; background: #000; display: flex; justify-content: space-between; align-items: center; }
        .log-container { flex: 1; overflow-y: auto; padding: 10px; font-size: 0.85rem; }
        
        /* Log Entries */
        .log-entry { margin-bottom: 5px; padding: 5px; border-bottom: 1px solid #333; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        .type-click { color: var(--accent); }
        .type-keypress { color: #ffdd59; }
        .type-focus { color: #0fbcf9; }
        
        /* Security Warning */
        #alertBox { display: none; background: var(--warning); color: white; padding: 10px; text-align: center; font-weight: bold; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; }
        
        .controls { padding: 20px; background: #2f3542; display: flex; gap: 10px; }
        button { cursor: pointer; border: none; padding: 10px; border-radius: 4px; font-weight: bold; }
        .btn-reset { background: #57606f; color: white; }
        .btn-export { background: var(--accent); color: white; }
    </style>
</head>
<body>

<div id="alertBox">⚠️ SYSTEM WARNING: SUSPICIOUS ACTIVITY DETECTED (EXCESSIVE CLICKS)</div>

<div class="workspace">
    <h1>Interactive Workspace</h1>
    <p>Every move in this area is being tracked by the monitor on the right.</p>
    <button id="btn1">Click</button>
    <input type="text" class="input-box" placeholder="Type something here..." id="inputField">
    <input type="text" class="input-box" placeholder="Focus change test..." id="inputField2">
</div>

<div class="monitor-panel">
    <div class="monitor-header">
        <span>LIVE ACTIVITY LOG</span>
        <span id="clickCounter">Clicks: 0</span>
    </div>
    <div class="log-container" id="logContainer"></div>
    <div class="controls">
        <button class="btn-reset" onclick="resetLogs()">Reset Log</button>
        <button class="btn-export" onclick="exportLogs()">Export TXT</button>
    </div>
</div>

<script>
    // 2. Activity Storage
    let activityLog = [];
    let clickCount = 0;
    const CLICK_THRESHOLD = 10; // Clicks within 5 seconds

    const logContainer = document.getElementById('logContainer');
    const clickDisplay = document.getElementById('clickCounter');
    const alertBox = document.getElementById('alertBox');

    // 1 & 3. Universal Event Listeners (Event Bubbling)
    document.addEventListener('click', (e) => logActivity('CLICK', e.target.tagName + (e.target.id ? ` (#${e.target.id})` : '')), true);
    document.addEventListener('keydown', (e) => logActivity('KEYPRESS', `Key: ${e.key}`), true);
    
    // Using Capture for focus events because focus doesn't bubble
    document.addEventListener('focus', (e) => logActivity('FOCUS', `Entered ${e.target.id || e.target.tagName}`), true);

    function logActivity(type, detail) {
        const timestamp = new Date().toLocaleTimeString();
        const entry = { timestamp, type, detail };
        activityLog.push(entry);

        // 4. Dynamic DOM Update
        const logHtml = `
            <div class="log-entry">
                [${timestamp}] <span class="type-${type.toLowerCase()}">${type}</span>: ${detail}
            </div>
        `;
        logContainer.insertAdjacentHTML('afterbegin', logHtml);

        // 5. Suspicious Activity Monitoring
        if (type === 'CLICK') {
            clickCount++;
            clickDisplay.innerText = `Clicks: ${clickCount}`;
            if (clickCount > CLICK_THRESHOLD) {
                alertBox.style.display = 'block';
            }
        }
    }

    // Reset suspicious count every 5 seconds
    setInterval(() => {
        if (clickCount <= CLICK_THRESHOLD) alertBox.style.display = 'none';
        clickCount = 0;
        clickDisplay.innerText = `Clicks: 0`;
    }, 5000);

    // 6. Reset and Export
    function resetLogs() {
        activityLog = [];
        logContainer.innerHTML = '';
        clickCount = 0;
        alertBox.style.display = 'none';
    }

    function exportLogs() {
        if (activityLog.length === 0) return alert("Log is empty.");
        
        const formattedText = activityLog
            .map(log => `[${log.timestamp}] ${log.type}: ${log.detail}`)
            .join('\n');
            
        const blob = new Blob([formattedText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `activity_log_${Date.now()}.txt`;
        a.click();
    }
</script>

</body>
</html>