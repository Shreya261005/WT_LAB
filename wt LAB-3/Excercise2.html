<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Intelligent Cart - Integrated View</title>
    <style>
        :root { --inr-blue: #1b1464; --discount-green: #009432; --card-bg: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: #f1f2f6; margin: 0; padding: 20px; color: #2f3542; }
        .container { max-width: 900px; margin: 0 auto; }
        
        /* Product Grid */
        .product-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .item-card { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-left: 6px solid var(--inr-blue); }
        .item-card h4 { margin: 0 0 10px 0; }
        
        /* Cart Section - Now Below */
        .cart-section { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
        .cart-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; padding: 15px 0; border-bottom: 1px solid #eee; align-items: center; }
        .cart-header { font-weight: bold; color: var(--inr-blue); border-bottom: 2px solid var(--inr-blue); }
        
        /* Discount Indicators */
        .disc-label { display: block; font-size: 0.75rem; color: var(--discount-green); font-weight: bold; margin-top: 4px; }
        .coupon-box { background: #dfe4ea; padding: 20px; border-radius: 10px; margin: 20px 0; display: flex; gap: 10px; align-items: center; }
        
        /* Final Summary */
        .summary-total { margin-top: 20px; text-align: right; padding: 20px; background: var(--inr-blue); color: white; border-radius: 10px; }
        button { cursor: pointer; padding: 8px 15px; border-radius: 5px; border: none; font-weight: bold; }
        .btn-add { background: var(--inr-blue); color: white; width: 100%; margin-top: 10px; }
        .btn-qty { background: #ced4da; }
    </style>
</head>
<body>

<div class="container">
    <h2>üõçÔ∏è Product Catalog</h2>
    <div class="product-list" id="productList"></div>

    <div class="cart-section">
        <h2>üõí Your Shopping Cart</h2>
        
        <div class="coupon-box">
            <input type="text" id="couponInput" placeholder="ENTER CODE (e.g., SAVE15_TECH)" style="padding:10px; flex:1; border: 1px solid #ccc; border-radius: 5px;">
            <button onclick="applyCoupon()" style="background: var(--discount-green); color: white;">Apply Coupon</button>
        </div>

        <div id="cartContent">
            </div>

        <div class="summary-total" id="finalSummary">
            </div>
    </div>
</div>

<script>
    const inventory = [
        { id: 1, name: "Smart Laptop", price: 65000, category: "Tech" },
        { id: 2, name: "Wireless Earbuds", price: 2500, category: "Tech" },
        { id: 3, name: "Gaming Mouse", price: 1800, category: "Tech" },
        { id: 4, name: "Office Desk", price: 12000, category: "Furniture" },
        { id: 5, name: "Yoga Block", price: 600, category: "Fitness" },
        { id: 6, name: "Protein Shaker", price: 450, category: "Fitness" },
        { id: 7, name: "LED Strip Lights", price: 999, category: "Home" }
    ];

    let cart = [];
    let activeCoupon = null;
    const formatINR = (num) => "‚Çπ" + num.toLocaleString('en-IN');

    // Initialize Products
    function displayProducts() {
        const list = document.getElementById('productList');
        list.innerHTML = inventory.map(p => `
            <div class="item-card">
                <small>${p.category}</small>
                <h4>${p.name}</h4>
                <div style="font-size: 1.2rem; font-weight: bold;">${formatINR(p.price)}</div>
                <button class="btn-add" onclick="addToCart(${p.id})">Add to Cart</button>
            </div>
        `).join('');
    }

    function addToCart(id) {
        const item = cart.find(i => i.id === id);
        if (item) item.qty++;
        else {
            const prod = inventory.find(p => p.id === id);
            cart.push({ ...prod, qty: 1 });
        }
        renderCart();
    }

    function updateQty(id, change) {
        const item = cart.find(i => i.id === id);
        if (item) {
            item.qty += change;
            if (item.qty <= 0) cart = cart.filter(i => i.id !== id);
        }
        renderCart();
    }

    function applyCoupon() {
        const input = document.getElementById('couponInput').value.trim().toUpperCase();
        if (input.includes("_")) {
            const [code, cat] = input.split("_");
            const percent = parseInt(code.replace("SAVE", ""));
            activeCoupon = { percent, category: cat };
            alert(`Success! ${percent}% discount applied to ${cat} products.`);
        } else {
            alert("Invalid Format. Try: SAVE10_TECH");
        }
        renderCart();
    }

    // Logic for individual discounts
    function getDiscounts(item) {
        let list = [];
        let totalDisc = 0;
        const basePrice = item.price * item.qty;

        // 1. Bulk Discount (5% if qty > 2)
        if (item.qty > 2) {
            let d = basePrice * 0.05;
            totalDisc += d;
            list.push(`Bulk Savings: -${formatINR(d)}`);
        }

        // 2. Coupon Discount
        if (activeCoupon && item.category.toUpperCase() === activeCoupon.category.toUpperCase()) {
            let d = basePrice * (activeCoupon.percent / 100);
            totalDisc += d;
            list.push(`${activeCoupon.percent}% Coupon: -${formatINR(d)}`);
        }

        return { labels: list, amount: totalDisc };
    }

    function renderCart() {
        const content = document.getElementById('cartContent');
        const summary = document.getElementById('finalSummary');

        if (cart.length === 0) {
            content.innerHTML = "<p>Your cart is empty.</p>";
            summary.style.display = "none";
            return;
        }

        summary.style.display = "block";
        let cartHTML = `
            <div class="cart-row cart-header">
                <div>Product & Discounts</div>
                <div>Price</div>
                <div>Quantity</div>
                <div>Subtotal</div>
            </div>`;

        let grandTotal = 0;
        let totalSavings = 0;

        cart.forEach(item => {
            const disc = getDiscounts(item);
            const lineTotal = (item.price * item.qty) - disc.amount;
            grandTotal += lineTotal;
            totalSavings += disc.amount;

            cartHTML += `
                <div class="cart-row">
                    <div>
                        <strong>${item.name}</strong>
                        ${disc.labels.map(l => `<span class="disc-label">‚úÖ ${l}</span>`).join('')}
                    </div>
                    <div>${formatINR(item.price)}</div>
                    <div>
                        <button class="btn-qty" onclick="updateQty(${item.id}, -1)">-</button>
                        ${item.qty}
                        <button class="btn-qty" onclick="updateQty(${item.id}, 1)">+</button>
                    </div>
                    <div>${formatINR(lineTotal)}</div>
                </div>
            `;
        });

        content.innerHTML = cartHTML;
        summary.innerHTML = `
            <div>Total Savings: ${formatINR(totalSavings)}</div>
            <div style="font-size: 1.5rem; margin-top: 10px;">Grand Total: ${formatINR(grandTotal)}</div>
        `;
    }

    displayProducts();
</script>

</body>
</html>